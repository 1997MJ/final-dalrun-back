<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace = "com.dalrun.dao.GpxDataDao">
	
	<!-- 공통 -->
	<sql id="searchGpxList">
		<if test="choice != null and choice != '' and search != null and search != ''">
			AND memId LIKE CONCAT('%', #{search}, '%')
		</if>
	</sql>

	<!-- gpx 데이터 전체 조회-->
    <select id="gpxDataList" parameterType="com.dalrun.dto.GpxParam"
    	resultType="com.dalrun.dto.GpxDataDto">
        SELECT *
        FROM 
        	(SELECT ROW_NUMBER()OVER(ORDER BY diarySeq ASC) AS RNUM, dataSeq, fileSeq, diarySeq,
        		courseSeq, memId, latitude, altitude, mTime 
        	 FROM gpxdata
        	 <include refid="searchGpxList"></include>
        	 ORDER BY diarySeq ASC) A
        WHERE RNUM BETWEEN ${start} AND ${end}
    </select>
    
    <!-- 업로드 시 하나의 기록 insert -->
    <insert id="insertGpxData" parameterType="com.dalrun.dto.GpxDataDto">
    	INSERT INTO gpxdata
    	(fileSeq, diarySeq, memId, latitude, longitude, altitude, distance, mTime, timeDiff)
    	VALUES (#{fileSeq}, #{diarySeq}, #{memId}, #{latitude}, #{longitude}, #{altitude}, 
    			#{distance}, #{mTime}, #{timeDiff})
    </insert>
    
    <!-- insert한 기록 데이터 전달 -->
    <select id="getGPXData" resultType="com.dalrun.dto.GpxDataDto">
    	SELECT *
    	FROM gpxdata
    	WHERE fileSeq = #{fileSeq}
    </select>
    
</mapper>